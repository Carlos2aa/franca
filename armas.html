<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Vendas - Fran√ßa Armas</title>

<style>
  :root {
    --primary: #0055A4;
    --secondary: #EF4135;
    --bg: #0f0f12;
    --card-bg: #1a1a1f;
    --text: #eee;
    --border: #333;
    --success: #2ecc71;
    --danger: #e74c3c;
    --highlight-blue: rgba(0, 85, 164, 0.2);
    --pix-bg: #2a2a35;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 900px;
    margin: auto;
    padding: 40px 20px;
  }

  h2 { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
  
  .creditos {
    font-size: 0.8rem;
    color: #666;
    margin-bottom: 30px;
    padding-left: 20px;
    font-style: italic;
  }

  h3 { margin-top: 0; color: var(--primary); font-size: 1.1rem; text-transform: uppercase; }

  .secao {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 12px;
    border: 1px solid var(--border);
    margin-bottom: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  }

  .grid-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 15px;
  }

  .form-group { display: flex; flex-direction: column; }

  label { font-size: 0.75rem; color: #888; margin-bottom: 8px; text-transform: uppercase; font-weight: bold; }
  .required { color: var(--secondary); margin-left: 4px; }

  /* Estilo do destaque do Pix */
  .destaque-pix {
    background: var(--pix-bg);
    color: #fff;
    padding: 12px 15px;
    border-radius: 8px;
    border-left: 4px solid #f39c12;
    margin-bottom: 15px;
    font-size: 0.85rem;
    font-weight: bold;
    display: block;
  }

  input, select {
    background: #25252b;
    border: 1px solid var(--border);
    color: #fff;
    padding: 12px;
    border-radius: 6px;
    outline: none;
    transition: 0.3s;
    height: 45px;
    box-sizing: border-box;
  }

  input:focus { border-color: var(--primary); box-shadow: 0 0 5px rgba(0, 85, 164, 0.4); }

  .tabela-container { border-radius: 8px; overflow: hidden; border: 1px solid var(--border); }
  
  .tabela-header {
    background: #25252b;
    display: grid;
    grid-template-columns: 2fr 1fr 100px 1fr;
    gap: 10px;
    padding: 15px;
    font-weight: bold;
    font-size: 0.85rem;
    border-bottom: 2px solid var(--border);
  }

  .linha {
    display: grid;
    grid-template-columns: 2fr 1fr 100px 1fr;
    gap: 10px;
    align-items: center;
    padding: 10px 15px;
    border-bottom: 1px solid #2a2a2a;
    transition: 0.2s;
  }

  .linha:hover { background: #222228; }
  .linha.vendido { 
    background: var(--highlight-blue); 
    border-left: 4px solid var(--primary); 
  }

  .painel-acoes { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }

  .total-card {
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 10px;
  }

  .total-item { display: flex; flex-direction: column; }
  .total-item label { color: rgba(255,255,255,0.7); margin-bottom: 2px; }
  .total-item span { font-size: 1.4rem; font-weight: 800; color: #fff; }
  .comissao-destaque { font-size: 1.1rem !important; color: #2ecc71 !important; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px; }

  button {
    padding: 15px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
    text-transform: uppercase;
  }

  .btn-primary { background: var(--primary); color: white; margin-bottom: 10px; width: 100%; }
  .btn-primary:hover:not(:disabled) { filter: brightness(1.2); transform: translateY(-2px); }
  .btn-primary:disabled { background: #333; color: #777; cursor: not-allowed; opacity: 0.6; }

  .btn-sec { background: var(--secondary); color: white; width: 100%; }
  .btn-brinde { background: #f39c12; color: white; margin-bottom: 15px; }

  .resumo-caixa {
    background: #000;
    color: #2ecc71;
    padding: 20px;
    border-radius: 8px;
    font-family: 'Courier New', Courier, monospace;
    white-space: pre-wrap;
    border: 1px dashed #444;
    margin-top: 15px;
  }

  .grid-brindes {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    background: #222;
    padding: 15px;
    border-radius: 8px;
  }

  hr { border: 0; border-top: 1px solid var(--border); margin: 25px 0; }
</style>
</head>

<body>

<h2>üßæ Registro de Venda ‚Äì Fran√ßa Armas</h2>
<div class="creditos">Desenvolvido por Demian Kalashnikov (Coroa)</div>

<div class="secao">
  <div class="grid-form">
    <div class="form-group">
      <label>ID do Vendedor <span class="required">*</span></label>
      <input id="codigoVendedor" placeholder="Digite seu ID" oninput="validarCampos()">
    </div>
    <div class="form-group">
      <label>Nome do Vendedor <span class="required">*</span></label>
      <input id="nomeVendedorManual" placeholder="Digite seu Nome" oninput="validarCampos()">
    </div>
  </div>

  <div class="grid-form">
    <div class="form-group">
      <label>Tipo de Venda</label>
      <select id="tipoVenda" onchange="alternarCampos();calcular();">
        <option value="pista">Pista</option>
        <option value="parceria">Parceria</option>
      </select>
    </div>
    <div class="form-group">
      <label id="labelDinamica">Comprador / ID <span class="required">*</span></label>
      <input id="comprador" placeholder="Nome ou Passaporte" oninput="validarCampos()">
      <input id="faccao" placeholder="Nome da Org" style="display:none" oninput="validarCampos()">
    </div>
  </div>
</div>

<div class="secao">
  <h3>üî´ Sele√ß√£o de Armamento</h3>
  <div class="tabela-container">
    <div class="tabela-header">
      <div>Arma</div>
      <div>Pre√ßo</div>
      <div>Qtd</div>
      <div>Total</div>
    </div>
    <div id="armas"></div>
  </div>
  
  <div class="painel-acoes">
    <div class="total-card">
      <div class="total-item">
        <label>Total Geral</label>
        <span id="total">R$ 0</span>
      </div>
      <div class="total-item">
        <label>Sua Comiss√£o (30%)</label>
        <span id="totalComissao" class="comissao-destaque">R$ 0</span>
      </div>
    </div>
    <div style="display: flex; flex-direction: column; justify-content: center;">
      <button class="btn-brinde" onclick="abrirBrinde()">üéÅ Adicionar Brindes</button>
      <div id="brindeBox" style="display:none; margin-bottom: 10px;"></div>
    </div>
  </div>
</div>

<div class="secao">
  <button id="btnResumo" class="btn-primary" onclick="mostrarResumo()" disabled>Gerar Resumo da Venda</button>
  <div id="resumo" class="resumo-caixa" style="display:none"></div>
  
  <hr>
  
  <span class="destaque-pix">üìé COMPROVANTE DE PAGAMENTO (OBRIGAT√ìRIO) PARA O PIX 680</span>
  <input type="file" id="comprovante" accept="image/*" style="margin-bottom: 20px; width: 100%; border: none; background: transparent; padding: 0;">

  <div class="grid-form">
    <button id="btnEnviar" class="btn-primary" onclick="enviarVenda()" disabled>üì® Enviar para Discord</button>
    <button class="btn-sec" onclick="novaVenda()">üîÑ Limpar Venda</button>
  </div>
</div>

<script>
const WEBHOOK="https://discord.com/api/webhooks/1457493465758961836/_3rggB-8yZSA4Zo4a2TFeSY7DB-qoDsUXXMqd63DHwAjY0IYJcJfRUIUpqRetQ60nv5d";

const armas=[
 {nome:"Fajuta",pista:38000,parceria:35000},
 {nome:"Five",pista:48000,parceria:45000},
 {nome:"Thompson",pista:73000,parceria:70000},
 {nome:"TEC-9",pista:78000,parceria:75000},
 {nome:"MIAR-21",pista:78000,parceria:75000},
 {nome:"Remington",pista:83000,parceria:80000},
 {nome:"Fuzil G36",pista:128000,parceria:120000},
 {nome:"AK-47",pista:128000,parceria:120000},
 {nome:"Parafal",pista:128000,parceria:120000},
 {nome:"HK",pista:128000,parceria:120000}
];

let brindes={};

window.onload = () => {
  const salvoID = localStorage.getItem('vendedorID');
  const salvoNome = localStorage.getItem('vendedorNome');
  if(salvoID) document.getElementById('codigoVendedor').value = salvoID;
  if(salvoNome) document.getElementById('nomeVendedorManual').value = salvoNome;
  validarCampos();
};

function format(v){return "R$ "+v.toLocaleString("pt-BR")}

const armasDiv=document.getElementById("armas");
armas.forEach((a,i)=>{
 armasDiv.innerHTML+=`
 <div class="linha" id="linha${i}">
  <div style="font-weight:bold">${a.nome}</div>
  <div id="preco${i}" style="color:#aaa">${format(a.pista)}</div>
  <input type="number" min="0" value="0" id="qtd${i}" oninput="calcular()">
  <div id="tot${i}" style="font-weight:bold">R$ 0</div>
 </div>`;
});

function validarCampos(){
 const id = document.getElementById('codigoVendedor').value.trim();
 const nome = document.getElementById('nomeVendedorManual').value.trim();
 const isPista = document.getElementById('tipoVenda').value === "pista";
 
 let temArma = false;
 armas.forEach((_,i)=>{
  if(Number(document.getElementById(`qtd${i}`).value) > 0) temArma = true;
 });
 
 let clienteValido = false;
 if(isPista) {
   clienteValido = document.getElementById('comprador').value.trim() !== "";
 } else {
   clienteValido = document.getElementById('faccao').value.trim() !== "";
 }

 document.getElementById('btnResumo').disabled = (id === "" || nome === "" || !clienteValido || !temArma);
}

function alternarCampos(){
 const isPista = tipoVenda.value === "pista";
 labelDinamica.innerHTML = isPista ? 'Comprador / ID <span class="required">*</span>' : 'Fac√ß√£o <span class="required">*</span>';
 comprador.style.display = isPista ? "block" : "none";
 faccao.style.display = isPista ? "none" : "block";
 validarCampos();
}

function calcular(){
 let total=0;
 armas.forEach((a,i)=>{
  const qtd=Number(document.getElementById(`qtd${i}`).value);
  const preco=tipoVenda.value==="pista"?a.pista:a.parceria;
  document.getElementById(`preco${i}`).innerText=format(preco);
  const soma=qtd*preco;
  document.getElementById(`tot${i}`).innerText=format(soma);
  document.getElementById(`linha${i}`).classList.toggle("vendido",qtd>0);
  total+=soma;
 });
 
 const comissao = total * 0.3;
 document.getElementById("total").innerText=format(total);
 document.getElementById("totalComissao").innerText=format(comissao);
 validarCampos();
}

function abrirBrinde(){
 brindeBox.style.display="block";
 let html="<div class='grid-brindes'>";
 armas.forEach((a,i)=>{
  html+=`<div style="font-size: 0.8rem; display: flex; justify-content: space-between; align-items: center;">
    <span>${a.nome}:</span> 
    <input type="number" style="padding:4px; width:45px; background:#111; border: 1px solid #444;" min="0" value="${brindes[i]||0}" 
    onchange="brindes[${i}]=this.value">
  </div>`;
 });
 html+="</div>";
 brindeBox.innerHTML=html;
}

function mostrarResumo(){
 calcular();
 document.getElementById('btnEnviar').disabled=false;
 resumo.style.display="block";

 let total=0,lista="",listaBrinde="";
 armas.forEach((a,i)=>{
  const qtd=Number(document.getElementById(`qtd${i}`).value);
  if(qtd){
   const p=tipoVenda.value==="pista"?a.pista:a.parceria;
   lista+=`‚Ä¢ ${a.nome}: ${qtd}x (${format(p)})\n`;
   total+=qtd*p;
  }
 });

 Object.keys(brindes).forEach(i=>{
  if(brindes[i]>0) listaBrinde+=`‚Ä¢ ${armas[i].nome} x ${brindes[i]}\n`;
 });

 const com=total*0.3, fr=total*0.7;

 resumo.innerText=
`SISTEMA FRAN√áA ARMAS - RESUMO
-----------------------------------
VENDEDOR: ${codigoVendedor.value} - ${nomeVendedorManual.value}
TIPO: ${tipoVenda.value.toUpperCase()}
CLIENTE: ${tipoVenda.value==="pista"?comprador.value:faccao.value}

ARMAS VENDIDAS:
${lista||"Nenhuma"}

BRINDES ENVIADOS:
${listaBrinde||"Nenhum"}

-----------------------------------
TOTAL GERAL: ${format(total)}
COMISS√ÉO (30%): ${format(com)}
FRAN√áA (70%): ${format(fr)}
-----------------------------------`;
}

async function enviarVenda(){
 if(!comprovante.files.length){alert("Por favor, anexe o comprovante!"); return;}
 
 localStorage.setItem('vendedorID', document.getElementById('codigoVendedor').value);
 localStorage.setItem('vendedorNome', document.getElementById('nomeVendedorManual').value);

 const btn = document.getElementById("btnEnviar");
 btn.innerText = "Enviando...";
 btn.disabled = true;

 const fd=new FormData();
 fd.append("file",comprovante.files[0]);
 fd.append("payload_json",JSON.stringify({
  embeds:[{
      title:"üöÄ Nova Venda Registrada",
      description: "```" + resumo.innerText + "```",
      color: 5793266,
      timestamp: new Date()
  }]
 }));

 try {
    await fetch(WEBHOOK,{method:"POST",body:fd});
    alert("Venda enviada com sucesso!");
    novaVenda(); 
 } catch(e) {
    alert("Erro ao enviar venda.");
 } finally {
    btn.innerText = "üì® Enviar para Discord";
    btn.disabled = false;
 }
}

function novaVenda(){
 armas.forEach((_,i)=>{
  document.getElementById(`qtd${i}`).value=0;
  document.getElementById(`tot${i}`).innerText="R$ 0";
  document.getElementById(`linha${i}`).classList.remove("vendido");
 });
 
 comprador.value=""; faccao.value="";
 brindes = {}; 
 brindeBox.style.display="none";
 brindeBox.innerHTML="";
 resumo.style.display="none";
 document.getElementById('btnEnviar').disabled=true;
 document.getElementById("total").innerText="R$ 0";
 document.getElementById("totalComissao").innerText="R$ 0";
 comprovante.value = ""; 
 validarCampos();
}
</script>

</body>
</html>

